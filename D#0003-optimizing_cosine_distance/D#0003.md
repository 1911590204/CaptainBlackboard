# 　　　　　　optimizing consine distance
## 引言
求解两个向量之间的距离(或者说相似度)，广泛应用于数据挖掘，图像处理和深度学习中。例如很多人脸识别的模型，在网络的最后一层都是计算出输入人脸的一个固定维数的特征向量，然后根据两个人脸对应的两个特征向量之间的距离来做人脸验证和识别。如果人脸底库的数量很大，计算特征向量之间的距离函数就会被调用很多次，所以优化这个最佳距离的计算函数就显得尤为重要。这里，我以优化两个512维向量之间的[余弦距离](https://en.wikipedia.org/wiki/Cosine_similarity)为例，试验一下在通用PC平台上到底能优化多少。

**欢迎探讨，本文持续维护。**

## 实验平台：

+ 操作系统：Ubuntu 16.04 LTS

+ 编译器：g++ (Ubuntu 5.4.0-6ubuntu1~16.04.10) 5.4.0 20160609

  　　　　gcc (Ubuntu 5.4.0-6ubuntu1~16.04.10) 5.4.0 20160609

+ 硬件配置：
          1. CPU Intel(R) Core(TM) i7-7700 CPU @ 3.60GHz
          2. Memory 8G DDR2
          3. GPU N/A


### Step 1,最基础的实现方式

最基础的实现方式也是最容易的方式，作为我们的起点，实验代码：

![]()

耗用了3846454us

### Step 2, 打开优化开关-O3 -Ofast -ffast-math(牺牲了精度)

耗用了398475us，差不多加速了**x10倍**

### Step 3, 数据类型优化，double->float(牺牲了精度)
耗用了205285us，加速**x2倍**

### Step 4, xXXX


## 杂项


## 总结


## 参考资料
+ [《深入理解计算机系统》](https://book.douban.com/subject/1896753/)
